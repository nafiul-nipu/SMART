

function AlllineCurve(m_ettnicity, m_gender, m_site) {

    glottic_male = {
        treatments: [
            [
                //african_glottic_male
                {t: 0, d: 0, n: 15},
                {t: 10.267, d: 0, n: 15},
                {t: 10.533, d: 0, n: 14},
                {t: 26.167, d: 1, n: 13},
                {t: 31.2, d: 1, n: 12},
                {t: 32.633, d: 1, n: 11},
                {t: 33.167, d: 0, n: 10},
                {t: 35.433, d: 0, n: 9},
                {t: 38.967, d: 1, n: 8},
                {t: 44.667, d: 1, n: 7},
                {t: 44.833, d: 1, n: 6},
                {t: 66.667, d: 1, n: 5},
                {t: 71.3, d: 1, n: 4},
                {t: 82.367, d: 0, n: 3},
                {t: 105.9, d: 1, n: 2},
                {t: 279.1, d: 1, n: 1}
            ],
            [
                //asian_glottic_male
                {t: 0, d: 0, n: 1},
                {t: 4.66667, d: 1, n: 1}
            ]
                    ,
            [
                //tispanic_glottic_male
                {t: 0, d: 0, n: 22},
                {t: 11, d: 1, n: 22},
                {t: 11.967, d: 1, n: 21},
                {t: 19.333, d: 0, n: 20},
                {t: 22.567, d: 1, n: 19},
                {t: 23.133, d: 1, n: 18},
                {t: 33.933, d: 0, n: 17},
                {t: 36.4, d: 0, n: 16},
                {t: 38.6, d: 0, n: 15},
                {t: 40.633, d: 0, n: 14},
                {t: 41.867, d: 1, n: 13},
                {t: 49.5, d: 0, n: 12},
                {t: 49.633, d: 1, n: 11},
                {t: 66.2, d: 0, n: 10},
                {t: 76.4, d: 1, n: 9},
                {t: 87.1, d: 1, n: 8},
                {t: 115.8, d: 0, n: 7},
                {t: 134.967, d: 1, n: 6},
                {t: 154.533, d: 0, n: 5},
                {t: 171.367, d: 0, n: 4},
                {t: 206.933, d: 1, n: 3},
                {t: 260.767, d: 1, n: 2},
                {t: 292.967, d: 1, n: 1}
            ]
                    ,
            [//otter_glottic_male
                {t: 0, d: 0, n: 5},
                {t: 10.067, d: 0, n: 5},
                {t: 14.167, d: 0, n: 3},
                {t: 78.433, d: 0, n: 2},
                {t: 307.067, d: 0, n: 1}
            ]
                    ,
            [
                //wtite_glottic_male
                {t: 0, d: 0, n: 50},
                {t: 6.5, d: 1, n: 50},
                {t: 13.367, d: 2, n: 49},
                {t: 15.3, d: 1, n: 47},
                {t: 16.133, d: 2, n: 46},
                {t: 16.5, d: 1, n: 44},
                {t: 17.167, d: 1, n: 43},
                {t: 17.667, d: 1, n: 42},
                {t: 18.833, d: 0, n: 41},
                {t: 23.533, d: 1, n: 40},
                {t: 23.6, d: 1, n: 39},
                {t: 32.7, d: 0, n: 38},
                {t: 36.333, d: 1, n: 37},
                {t: 41.733, d: 0, n: 36},
                {t: 45.633, d: 0, n: 35},
                {t: 48.333, d: 0, n: 34},
                {t: 50.167, d: 0, n: 33},
                {t: 50.567, d: 0, n: 32},
                {t: 61.567, d: 0, n: 31},
                {t: 67.067, d: 0, n: 30},
                {t: 68.867, d: 0, n: 29},
                {t: 70.967, d: 0, n: 28},
                {t: 71.233, d: 1, n: 27},
                {t: 72.833, d: 0, n: 26},
                {t: 79.633, d: 0, n: 25},
                {t: 80, d: 0, n: 24},
                {t: 86.933, d: 1, n: 23},
                {t: 87.1, d: 0, n: 22},
                {t: 87.333, d: 1, n: 21},
                {t: 97.667, d: 0, n: 20},
                {t: 99.967, d: 0, n: 19},
                {t: 105.367, d: 0, n: 18},
                {t: 108.467, d: 1, n: 17},
                {t: 117.567, d: 0, n: 16},
                {t: 122.033, d: 0, n: 15},
                {t: 123.833, d: 1, n: 14},
                {t: 131.6, d: 0, n: 13},
                {t: 135.767, d: 1, n: 12},
                {t: 140.933, d: 1, n: 11},
                {t: 141.733, d: 1, n: 10},
                {t: 146.4, d: 1, n: 9},
                {t: 165.6, d: 1, n: 8},
                {t: 176.5, d: 1, n: 7},
                {t: 177.867, d: 1, n: 6},
                {t: 203.033, d: 1, n: 5},
                {t: 225.2, d: 1, n: 4},
                {t: 258.833, d: 1, n: 3},
                {t: 288.2, d: 0, n: 2},
                {t: 320.633, d: 1, n: 1}
            ]
        ]};

    glottic_female = {
        treatments: [
            [
                //african_glottic_female
                {t: 0, d: 0, n: 4},
                {t: 18.8667, d: 1, n: 4},
                {t: 21, d: 1, n: 3},
                {t: 50.6333, d: 1, n: 2},
                {t: 84.8667, d: 0, n: 1}
            ]
                    ,
            [
                //asian_glottic_female
                {t: 0, d: 0, n: 0}
            ]
                    ,
            [
                //hispanic_glottic_female
                {t: 0, d: 0, n: 1},
                {t: 264.533, d: 0, n: 1}
            ]
                    ,
            [
                //other_glottic_female
                {t: 0, d: 0, n: 0}
            ]
                    ,
            [//white_glottic_female
                {t: 0, d: 0, n: 8},
                {t: 32, d: 0, n: 8},
                {t: 60.133, d: 1, n: 7},
                {t: 85.467, d: 0, n: 6},
                {t: 105.033, d: 1, n: 5},
                {t: 135.233, d: 0, n: 4},
                {t: 137.267, d: 1, n: 3},
                {t: 181.367, d: 1, n: 2},
                {t: 213.233, d: 0, n: 1}
            ]
        ]};

    subglottic_male = {
        treatments: [
            [
                //african_subglottic_male
                {t: 0, d: 0, n: 0}
            ]
                    ,
            [
                //asian_subglottic_male
                {t: 0, d: 0, n: 0}
            ],
            [
                //hispanic_subglottic_male
                {t: 0, d: 0, n: 1},
                {t: 144.3, d: 1, n: 1}
            ]
                    ,
            [
                //white_subglottic_male
                {t: 0, d: 0, n: 2},
                {t: 20.267, d: 1, n: 2},
                {t: 150.6, d: 0, n: 1}
            ]

        ]};

    subglottic_female = {
        treatments: [
            [
                //african_subglottic_male
                {t: 0, d: 0, n: 0}
            ],
            [
                //hispanic_subglottic_male
                {t: 0, d: 0, n: 0}
            ],
            [
                //asian_subglottic_male
                {t: 0, d: 0, n: 0}
            ],
            [
                //other_subglottic_male
                {t: 0, d: 0, n: 0}
            ],
            [
                //white_subglottic_female
                {t: 0, d: 0, n: 1},
                {t: 20.4667, d: 1, n: 1}
            ]
        ]};

    supraglottic_male = {
        treatments: [
            [
                //African_supraglottic_male
                {t: 0, d: 0, n: 41},
                {t: 5.7, d: 1, n: 41},
                {t: 5.767, d: 1, n: 40},
                {t: 6.533, d: 1, n: 39},
                {t: 11.267, d: 1, n: 38},
                {t: 12.167, d: 1, n: 37},
                {t: 12.467, d: 0, n: 36},
                {t: 12.9, d: 1, n: 35},
                {t: 13.1, d: 1, n: 34},
                {t: 15.167, d: 1, n: 33},
                {t: 17.167, d: 1, n: 32},
                {t: 26.6, d: 1, n: 31},
                {t: 29.8, d: 1, n: 30},
                {t: 31.033, d: 1, n: 29},
                {t: 32.4, d: 1, n: 28},
                {t: 32.433, d: 1, n: 27},
                {t: 33.533, d: 0, n: 26},
                {t: 35.667, d: 1, n: 24},
                {t: 39.3, d: 1, n: 23},
                {t: 40.067, d: 1, n: 22},
                {t: 42.833, d: 1, n: 21},
                {t: 49.633, d: 1, n: 20},
                {t: 55.533, d: 1, n: 19},
                {t: 56.7, d: 1, n: 18},
                {t: 57.7, d: 2, n: 17},
                {t: 59.4, d: 1, n: 15},
                {t: 60.733, d: 0, n: 14},
                {t: 61.833, d: 1, n: 13},
                {t: 66.967, d: 0, n: 12},
                {t: 73.333, d: 1, n: 11},
                {t: 81.967, d: 0, n: 10},
                {t: 85.467, d: 1, n: 9},
                {t: 98.667, d: 0, n: 8},
                {t: 105.867, d: 0, n: 7},
                {t: 109.4, d: 1, n: 6},
                {t: 110.067, d: 1, n: 5},
                {t: 116.267, d: 1, n: 4},
                {t: 125.9, d: 0, n: 3},
                {t: 151.667, d: 1, n: 2},
                {t: 152.1, d: 0, n: 1}
            ]
                    ,
            [
                //asian_supraglottic_male
                {t: 0, d: 0, n: 3},
                {t: 15.1, d: 1, n: 3},
                {t: 38.5333, d: 0, n: 2},
                {t: 96.0667, d: 1, n: 1}
            ]
                    ,
            [
                //hispanic_supraglottic_male
                {t: 0, d: 0, n: 35},
                {t: 5.767, d: 1, n: 35},
                {t: 9.133, d: 1, n: 34},
                {t: 10.733, d: 1, n: 33},
                {t: 12.033, d: 1, n: 32},
                {t: 13.767, d: 0, n: 31},
                {t: 14.233, d: 1, n: 30},
                {t: 16.233, d: 1, n: 29},
                {t: 17.867, d: 1, n: 28},
                {t: 19.833, d: 1, n: 27},
                {t: 19.9, d: 1, n: 26},
                {t: 19.967, d: 1, n: 25},
                {t: 22.2, d: 1, n: 24},
                {t: 22.967, d: 1, n: 23},
                {t: 24.333, d: 0, n: 22},
                {t: 24.633, d: 1, n: 21},
                {t: 25.1, d: 1, n: 20},
                {t: 31.3, d: 1, n: 19},
                {t: 37.9, d: 1, n: 18},
                {t: 41.967, d: 1, n: 17},
                {t: 47.233, d: 0, n: 16},
                {t: 55.6, d: 0, n: 15},
                {t: 57.667, d: 0, n: 14},
                {t: 59.3, d: 0, n: 13},
                {t: 65.733, d: 0, n: 12},
                {t: 74.8, d: 0, n: 11},
                {t: 88.667, d: 1, n: 10},
                {t: 108.067, d: 1, n: 9},
                {t: 109.133, d: 0, n: 8},
                {t: 115.667, d: 0, n: 7},
                {t: 130.767, d: 0, n: 6},
                {t: 131.833, d: 1, n: 5},
                {t: 140.8, d: 1, n: 4},
                {t: 155.233, d: 0, n: 3},
                {t: 166.767, d: 1, n: 2},
                {t: 223.033, d: 1, n: 1}
            ]
                    ,
            [
                //other_supraglottic_male
                {t: 0, d: 0, n: 5},
                {t: 16.7, d: 0, n: 5},
                {t: 52.733, d: 0, n: 4},
                {t: 73.6, d: 1, n: 3},
                {t: 98.633, d: 0, n: 2},
                {t: 296.7, d: 0, n: 1}
            ]
                    ,
            [
                //white_supraglottic_male
                {t: 0, d: 0, n: 199},
                {t: 4.5, d: 1, n: 199},
                {t: 5.967, d: 1, n: 198},
                {t: 6.433, d: 0, n: 197},
                {t: 6.867, d: 1, n: 196},
                {t: 7.067, d: 1, n: 195},
                {t: 7.233, d: 1, n: 194},
                {t: 7.267, d: 1, n: 193},
                {t: 7.8, d: 1, n: 192},
                {t: 7.9, d: 1, n: 191},
                {t: 8.167, d: 1, n: 190},
                {t: 8.633, d: 1, n: 189},
                {t: 9.6, d: 1, n: 188},
                {t: 9.8, d: 1, n: 187},
                {t: 10.1, d: 1, n: 186},
                {t: 10.2, d: 1, n: 185},
                {t: 10.767, d: 1, n: 184},
                {t: 11.533, d: 1, n: 183},
                {t: 11.933, d: 1, n: 182},
                {t: 12.3, d: 1, n: 181},
                {t: 12.5, d: 1, n: 180},
                {t: 12.567, d: 1, n: 179},
                {t: 14.033, d: 1, n: 178},
                {t: 14.2, d: 1, n: 177},
                {t: 14.967, d: 1, n: 176},
                {t: 15.033, d: 1, n: 175},
                {t: 15.133, d: 1, n: 174},
                {t: 15.433, d: 1, n: 173},
                {t: 15.467, d: 1, n: 172},
                {t: 15.633, d: 1, n: 171},
                {t: 15.933, d: 1, n: 170},
                {t: 16.533, d: 1, n: 169},
                {t: 16.733, d: 1, n: 168},
                {t: 16.833, d: 1, n: 167},
                {t: 17.2, d: 1, n: 166},
                {t: 18.533, d: 1, n: 165},
                {t: 18.9, d: 1, n: 164},
                {t: 19.4, d: 1, n: 163},
                {t: 20.267, d: 1, n: 162},
                {t: 20.5, d: 2, n: 161},
                {t: 20.533, d: 1, n: 159},
                {t: 20.567, d: 1, n: 158},
                {t: 20.9, d: 1, n: 157},
                {t: 20.933, d: 1, n: 156},
                {t: 21.7, d: 1, n: 155},
                {t: 21.967, d: 1, n: 154},
                {t: 22.267, d: 1, n: 153},
                {t: 24.033, d: 1, n: 152},
                {t: 24.1, d: 1, n: 151},
                {t: 24.167, d: 0, n: 150},
                {t: 24.3, d: 1, n: 149},
                {t: 24.767, d: 1, n: 148},
                {t: 25.267, d: 1, n: 147},
                {t: 25.367, d: 1, n: 146},
                {t: 25.567, d: 1, n: 145},
                {t: 26.3, d: 1, n: 144},
                {t: 26.567, d: 0, n: 143},
                {t: 26.7, d: 1, n: 142},
                {t: 28.5, d: 1, n: 141},
                {t: 28.733, d: 1, n: 140},
                {t: 29.2, d: 1, n: 139},
                {t: 29.667, d: 1, n: 138},
                {t: 32.433, d: 0, n: 137},
                {t: 32.567, d: 1, n: 136},
                {t: 32.6, d: 1, n: 135},
                {t: 33.333, d: 2, n: 134},
                {t: 33.733, d: 1, n: 132},
                {t: 33.967, d: 1, n: 131},
                {t: 34.533, d: 1, n: 130},
                {t: 35.367, d: 1, n: 129},
                {t: 35.667, d: 1, n: 128},
                {t: 36.3, d: 1, n: 127},
                {t: 36.333, d: 0, n: 126},
                {t: 36.967, d: 1, n: 125},
                {t: 38.4, d: 1, n: 124},
                {t: 38.767, d: 1, n: 123},
                {t: 38.967, d: 1, n: 122},
                {t: 39, d: 1, n: 121},
                {t: 39.133, d: 1, n: 120},
                {t: 39.367, d: 0, n: 119},
                {t: 39.533, d: 0, n: 118},
                {t: 39.867, d: 1, n: 117},
                {t: 40.5, d: 0, n: 116},
                {t: 41.933, d: 1, n: 115},
                {t: 42.533, d: 1, n: 114},
                {t: 42.567, d: 0, n: 113},
                {t: 43.767, d: 1, n: 112},
                {t: 44.533, d: 1, n: 111},
                {t: 44.933, d: 1, n: 110},
                {t: 45.133, d: 1, n: 109},
                {t: 45.3, d: 0, n: 108},
                {t: 46.933, d: 0, n: 107},
                {t: 47.6, d: 0, n: 106},
                {t: 48.5, d: 0, n: 105},
                {t: 49.067, d: 1, n: 104},
                {t: 49.167, d: 1, n: 103},
                {t: 49.467, d: 0, n: 102},
                {t: 49.633, d: 1, n: 101},
                {t: 51.1, d: 1, n: 100},
                {t: 51.667, d: 1, n: 99},
                {t: 51.767, d: 0, n: 98},
                {t: 51.967, d: 1, n: 97},
                {t: 52.167, d: 0, n: 96},
                {t: 52.967, d: 1, n: 95},
                {t: 53.233, d: 1, n: 94},
                {t: 53.767, d: 1, n: 93},
                {t: 53.8, d: 1, n: 92},
                {t: 55.5, d: 1, n: 91},
                {t: 56.167, d: 0, n: 90},
                {t: 56.567, d: 1, n: 89},
                {t: 56.833, d: 1, n: 88},
                {t: 56.867, d: 0, n: 87},
                {t: 59.067, d: 1, n: 86},
                {t: 60.833, d: 1, n: 85},
                {t: 62.233, d: 1, n: 84},
                {t: 63.567, d: 1, n: 83},
                {t: 63.967, d: 1, n: 82},
                {t: 64.033, d: 1, n: 81},
                {t: 64.933, d: 1, n: 80},
                {t: 65.233, d: 1, n: 79},
                {t: 66.333, d: 0, n: 78},
                {t: 67.167, d: 0, n: 77},
                {t: 67.667, d: 1, n: 76},
                {t: 68.5, d: 1, n: 75},
                {t: 70.033, d: 1, n: 74},
                {t: 70.067, d: 1, n: 73},
                {t: 70.733, d: 0, n: 72},
                {t: 70.9, d: 0, n: 71},
                {t: 71.033, d: 1, n: 70},
                {t: 74.167, d: 1, n: 69},
                {t: 76.3, d: 0, n: 68},
                {t: 76.833, d: 1, n: 67},
                {t: 77.033, d: 0, n: 66},
                {t: 78.6, d: 1, n: 65},
                {t: 79.4, d: 1, n: 64},
                {t: 79.9, d: 0, n: 63},
                {t: 80.833, d: 1, n: 62},
                {t: 80.9, d: 1, n: 61},
                {t: 81.2, d: 1, n: 60},
                {t: 82.533, d: 0, n: 59},
                {t: 84.467, d: 1, n: 58},
                {t: 84.5, d: 0, n: 57},
                {t: 85.6, d: 1, n: 56},
                {t: 87.567, d: 1, n: 55},
                {t: 88.433, d: 1, n: 54},
                {t: 88.633, d: 1, n: 53},
                {t: 88.667, d: 0, n: 52},
                {t: 90.4, d: 0, n: 51},
                {t: 91.133, d: 1, n: 50},
                {t: 92.867, d: 1, n: 49},
                {t: 93.5, d: 0, n: 48},
                {t: 94.833, d: 0, n: 47},
                {t: 95.533, d: 1, n: 46},
                {t: 96.767, d: 1, n: 45},
                {t: 99, d: 0, n: 44},
                {t: 99.533, d: 1, n: 43},
                {t: 101.067, d: 1, n: 42},
                {t: 101.933, d: 1, n: 41},
                {t: 102.7, d: 1, n: 40},
                {t: 103.433, d: 1, n: 39},
                {t: 104.567, d: 1, n: 38},
                {t: 106.3, d: 1, n: 37},
                {t: 110.9, d: 0, n: 36},
                {t: 112.733, d: 0, n: 35},
                {t: 114.667, d: 1, n: 34},
                {t: 118, d: 1, n: 33},
                {t: 124.667, d: 1, n: 32},
                {t: 133.9, d: 1, n: 31},
                {t: 134.267, d: 0, n: 30},
                {t: 134.933, d: 1, n: 29},
                {t: 135.5, d: 1, n: 28},
                {t: 142.733, d: 0, n: 27},
                {t: 143.8, d: 0, n: 26},
                {t: 144.7, d: 1, n: 25},
                {t: 146.5, d: 1, n: 24},
                {t: 146.967, d: 0, n: 23},
                {t: 148.1, d: 1, n: 22},
                {t: 151.4, d: 1, n: 21},
                {t: 153.067, d: 1, n: 20},
                {t: 154.033, d: 1, n: 19},
                {t: 156, d: 1, n: 18},
                {t: 158.867, d: 0, n: 17},
                {t: 164.633, d: 1, n: 16},
                {t: 168.867, d: 1, n: 15},
                {t: 174.267, d: 1, n: 14},
                {t: 175.533, d: 0, n: 13},
                {t: 185.567, d: 1, n: 12},
                {t: 187.767, d: 1, n: 11},
                {t: 196.067, d: 0, n: 10},
                {t: 200.167, d: 0, n: 9},
                {t: 217.633, d: 1, n: 8},
                {t: 223.1, d: 0, n: 7},
                {t: 226.3, d: 0, n: 6},
                {t: 227.1, d: 1, n: 5},
                {t: 232.5, d: 0, n: 4},
                {t: 235.4, d: 1, n: 3},
                {t: 237.667, d: 1, n: 2},
                {t: 272.3, d: 0, n: 1}
            ]
        ]};

    supraglottic_female = {
        treatments: [
            [
                //african_supraglottic_female
                {t: 0, d: 0, n: 17},
                {t: 12.7, d: 1, n: 17},
                {t: 16.2, d: 1, n: 16},
                {t: 19.8, d: 1, n: 15},
                {t: 20.433, d: 1, n: 14},
                {t: 22.3, d: 1, n: 13},
                {t: 41.467, d: 1, n: 12},
                {t: 47.667, d: 0, n: 11},
                {t: 48.433, d: 1, n: 10},
                {t: 48.833, d: 0, n: 9},
                {t: 50.333, d: 1, n: 8},
                {t: 53.867, d: 0, n: 7},
                {t: 98.267, d: 1, n: 6},
                {t: 117.367, d: 1, n: 5},
                {t: 192.5, d: 1, n: 4},
                {t: 193.8, d: 1, n: 3},
                {t: 195.6, d: 0, n: 2},
                {t: 241.967, d: 1, n: 1}
            ]
                    ,
            [
                //asian_supraglottic_female
                {t: 0, d: 0, n: 0}
            ]
                    ,
            [
                //hispanic_supraglottic_female
                {t: 0, d: 0, n: 4},
                {t: 9.333, d: 0, n: 4},
                {t: 125.333, d: 1, n: 3},
                {t: 132.367, d: 0, n: 2},
                {t: 236.2, d: 1, n: 1}
            ]
                    ,
            [
                //other_supraglottic_female
                {t: 0, d: 0, n: 1},
                {t: 173.8, d: 1, n: 1}
            ]
                    ,
            [
                //white_supraglottic_female
                {t: 0, d: 0, n: 119},
                {t: 3.567, d: 1, n: 119},
                {t: 5.9, d: 1, n: 118},
                {t: 7.867, d: 1, n: 117},
                {t: 9.5, d: 1, n: 116},
                {t: 9.6, d: 1, n: 115},
                {t: 10.233, d: 1, n: 114},
                {t: 10.3, d: 1, n: 113},
                {t: 10.333, d: 1, n: 112},
                {t: 10.767, d: 1, n: 111},
                {t: 11.2, d: 1, n: 110},
                {t: 15.2, d: 1, n: 109},
                {t: 16.033, d: 1, n: 108},
                {t: 17.533, d: 1, n: 107},
                {t: 17.7, d: 1, n: 106},
                {t: 18.433, d: 1, n: 105},
                {t: 19.033, d: 1, n: 104},
                {t: 20.133, d: 1, n: 103},
                {t: 20.233, d: 1, n: 102},
                {t: 20.267, d: 1, n: 101},
                {t: 20.333, d: 1, n: 100},
                {t: 23.667, d: 1, n: 99},
                {t: 23.867, d: 1, n: 98},
                {t: 24.033, d: 1, n: 97},
                {t: 24.333, d: 1, n: 96},
                {t: 24.733, d: 1, n: 95},
                {t: 25.033, d: 1, n: 94},
                {t: 25.5, d: 1, n: 93},
                {t: 25.9, d: 1, n: 92},
                {t: 26.8, d: 1, n: 91},
                {t: 28.6, d: 1, n: 90},
                {t: 28.733, d: 1, n: 89},
                {t: 29.5, d: 1, n: 88},
                {t: 30.567, d: 1, n: 87},
                {t: 32.767, d: 1, n: 86},
                {t: 32.967, d: 1, n: 85},
                {t: 33.4, d: 1, n: 84},
                {t: 33.533, d: 1, n: 83},
                {t: 35.6, d: 1, n: 82},
                {t: 36.233, d: 0, n: 81},
                {t: 36.733, d: 1, n: 80},
                {t: 38.4, d: 1, n: 79},
                {t: 39.333, d: 1, n: 78},
                {t: 40.6, d: 1, n: 77},
                {t: 40.833, d: 1, n: 76},
                {t: 41.7, d: 1, n: 75},
                {t: 41.733, d: 1, n: 74},
                {t: 41.933, d: 1, n: 73},
                {t: 42.167, d: 1, n: 72},
                {t: 43.4, d: 1, n: 70},
                {t: 45.567, d: 1, n: 69},
                {t: 46.733, d: 1, n: 68},
                {t: 47, d: 1, n: 67},
                {t: 47.667, d: 0, n: 66},
                {t: 48.167, d: 1, n: 65},
                {t: 48.367, d: 0, n: 64},
                {t: 50.7, d: 1, n: 63},
                {t: 50.967, d: 1, n: 62},
                {t: 52.333, d: 1, n: 61},
                {t: 52.967, d: 1, n: 59},
                {t: 54.167, d: 1, n: 58},
                {t: 58.367, d: 1, n: 57},
                {t: 59.967, d: 1, n: 56},
                {t: 61.133, d: 1, n: 55},
                {t: 62.6, d: 1, n: 54},
                {t: 64.067, d: 1, n: 53},
                {t: 68.1, d: 0, n: 52},
                {t: 69.1, d: 1, n: 51},
                {t: 69.9, d: 1, n: 50},
                {t: 70.167, d: 1, n: 49},
                {t: 70.5, d: 1, n: 48},
                {t: 70.533, d: 0, n: 47},
                {t: 71.433, d: 1, n: 46},
                {t: 71.6, d: 0, n: 45},
                {t: 73.2, d: 1, n: 44},
                {t: 74.7, d: 1, n: 43},
                {t: 75.067, d: 1, n: 42},
                {t: 75.6, d: 1, n: 41},
                {t: 78.5, d: 1, n: 40},
                {t: 79.8, d: 0, n: 39},
                {t: 88.033, d: 1, n: 38},
                {t: 93.133, d: 1, n: 37},
                {t: 97.267, d: 1, n: 36},
                {t: 97.9, d: 1, n: 35},
                {t: 102.833, d: 0, n: 34},
                {t: 103.9, d: 1, n: 33},
                {t: 105.9, d: 1, n: 32},
                {t: 108.367, d: 0, n: 31},
                {t: 112, d: 1, n: 30},
                {t: 112.9, d: 1, n: 29},
                {t: 113.067, d: 1, n: 28},
                {t: 117.2, d: 1, n: 27},
                {t: 118.567, d: 0, n: 26},
                {t: 122.733, d: 0, n: 25},
                {t: 126.2, d: 1, n: 24},
                {t: 129.9, d: 1, n: 23},
                {t: 131.9, d: 1, n: 22},
                {t: 134.067, d: 1, n: 21},
                {t: 138.033, d: 1, n: 20},
                {t: 141.1, d: 1, n: 19},
                {t: 142.167, d: 1, n: 18},
                {t: 143.133, d: 1, n: 17},
                {t: 148.533, d: 0, n: 16},
                {t: 149.067, d: 1, n: 15},
                {t: 150.933, d: 1, n: 14},
                {t: 157.067, d: 1, n: 13},
                {t: 157.7, d: 1, n: 12},
                {t: 158.633, d: 1, n: 11},
                {t: 162.5, d: 1, n: 10},
                {t: 165.133, d: 1, n: 9},
                {t: 169.467, d: 1, n: 8},
                {t: 173.1, d: 1, n: 7},
                {t: 176.1, d: 1, n: 6},
                {t: 192.3, d: 0, n: 5},
                {t: 198.9, d: 1, n: 4},
                {t: 202.1, d: 1, n: 3},
                {t: 229.933, d: 1, n: 2},
                {t: 280, d: 1, n: 1}
            ]
        ]};

    transglottic_female = {
        treatments: [
            [
                //African_transglottic_female
                {t: 0, d: 0, n: 3},
                {t: 30.6, d: 1, n: 3},
                {t: 36.367, d: 1, n: 2},
                {t: 287.967, d: 0, n: 1}
            ]
                    ,
            [
                //asian_transglottic_female
                {t: 0, d: 0, n: 0}
            ]
                    ,
            [
                //hispanic_transglottic_female
                {t: 0, d: 0, n: 2},
                {t: 35.933, d: 0, n: 2},
                {t: 299.833, d: 0, n: 1}
            ]
                    ,
            [
                //white_transglottic_female
                {t: 0, d: 0, n: 6},
                {t: 26.667, d: 1, n: 6},
                {t: 65.6, d: 0, n: 5},
                {t: 82.4, d: 1, n: 4},
                {t: 86.933, d: 0, n: 3},
                {t: 177.633, d: 1, n: 2},
                {t: 221.733, d: 0, n: 1}
            ]
        ]};

    transglottic_male = {
        treatments: [
            [
                //African_transglottic_male
                {t: 0, d: 0, n: 16},
                {t: 7.2, d: 1, n: 16},
                {t: 8.7, d: 1, n: 15},
                {t: 11.9, d: 1, n: 14},
                {t: 15.1, d: 1, n: 13},
                {t: 15.467, d: 1, n: 12},
                {t: 28.1, d: 1, n: 11},
                {t: 33.367, d: 1, n: 10},
                {t: 39.033, d: 0, n: 9},
                {t: 45.233, d: 1, n: 8},
                {t: 56.9, d: 0, n: 7},
                {t: 63.367, d: 1, n: 6},
                {t: 78.633, d: 1, n: 5},
                {t: 85.967, d: 1, n: 4},
                {t: 116.2, d: 0, n: 3},
                {t: 136.133, d: 0, n: 2},
                {t: 167.367, d: 1, n: 1}
            ]
                    ,
            [
                //asian_transglottic_male
                {t: 0, d: 0, n: 0}
            ]
                    ,
            [
                //hispanic_transglottic_male
                {t: 0, d: 0, n: 16},
                {t: 12, d: 1, n: 16},
                {t: 13.633, d: 0, n: 15},
                {t: 15.067, d: 1, n: 14},
                {t: 16.967, d: 1, n: 13},
                {t: 28.467, d: 0, n: 12},
                {t: 34.3, d: 1, n: 11},
                {t: 57.967, d: 1, n: 10},
                {t: 84, d: 1, n: 9},
                {t: 84.433, d: 0, n: 8},
                {t: 86.2, d: 1, n: 7},
                {t: 101.633, d: 1, n: 6},
                {t: 117.967, d: 1, n: 5},
                {t: 151.233, d: 1, n: 4},
                {t: 185.733, d: 1, n: 3},
                {t: 252.5, d: 1, n: 2},
                {t: 263.1, d: 1, n: 1}
            ]
                    ,
            [
                //other_transglottic_male
                {t: 0, d: 0, n: 0}
            ]
                    ,
            [
                //white_transglottic_male
                {t: 0, d: 0, n: 56},
                {t: 4.833, d: 1, n: 56},
                {t: 5.5, d: 0, n: 55},
                {t: 6.867, d: 1, n: 54},
                {t: 7.2, d: 0, n: 53},
                {t: 8.967, d: 1, n: 52},
                {t: 10.333, d: 1, n: 51},
                {t: 11.2, d: 1, n: 50},
                {t: 11.333, d: 1, n: 49},
                {t: 11.6, d: 1, n: 48},
                {t: 12.5, d: 1, n: 47},
                {t: 12.7, d: 1, n: 46},
                {t: 12.967, d: 1, n: 45},
                {t: 14.467, d: 1, n: 44},
                {t: 15.067, d: 1, n: 43},
                {t: 23.267, d: 0, n: 42},
                {t: 24.4, d: 1, n: 41},
                {t: 25.367, d: 1, n: 40},
                {t: 29.067, d: 1, n: 39},
                {t: 33.767, d: 1, n: 38},
                {t: 35.533, d: 0, n: 37},
                {t: 35.833, d: 1, n: 36},
                {t: 36.167, d: 0, n: 35},
                {t: 39.533, d: 0, n: 34},
                {t: 41.633, d: 0, n: 33},
                {t: 43.433, d: 1, n: 32},
                {t: 43.633, d: 1, n: 31},
                {t: 48.167, d: 0, n: 30},
                {t: 56.633, d: 0, n: 29},
                {t: 57.2, d: 1, n: 28},
                {t: 57.433, d: 1, n: 27},
                {t: 59.4, d: 1, n: 26},
                {t: 59.933, d: 1, n: 25},
                {t: 61.433, d: 1, n: 24},
                {t: 71.433, d: 0, n: 23},
                {t: 74.367, d: 0, n: 22},
                {t: 74.467, d: 1, n: 21},
                {t: 75.733, d: 0, n: 20},
                {t: 92.933, d: 0, n: 19},
                {t: 105.7, d: 0, n: 18},
                {t: 109.733, d: 1, n: 17},
                {t: 118.333, d: 1, n: 16},
                {t: 119.967, d: 1, n: 15},
                {t: 121.367, d: 1, n: 14},
                {t: 125.333, d: 1, n: 13},
                {t: 135.6, d: 1, n: 12},
                {t: 141.533, d: 1, n: 11},
                {t: 163.6, d: 1, n: 10},
                {t: 192.633, d: 1, n: 9},
                {t: 193.2, d: 1, n: 8},
                {t: 203.167, d: 0, n: 7},
                {t: 207.867, d: 0, n: 6},
                {t: 215.933, d: 1, n: 5},
                {t: 239.167, d: 0, n: 4},
                {t: 263.633, d: 0, n: 3},
                {t: 264.9, d: 0, n: 2},
                {t: 293.067, d: 0, n: 1}]
        ]};

    if (site == 'glottic' && gender == 'male')
        data = glottic_male;
    else if (site == 'glottic' && gender == 'female')
        data = glottic_female;
    else if (site == 'subglottic' && gender == 'female')
        data = subglottic_female;
    else if (site == 'subglottic' && gender == 'male')
        data = subglottic_male;
    else if (site == 'supraglottic' && gender == 'female')
        data = supraglottic_female;
    else if (site == 'supraglottic' && gender == 'male')
        data = supraglottic_male;
    else if (site == 'transglottic' && gender == 'female')
        data = transglottic_female;
    else if (site == 'transglottic' && gender == 'male')
        data = transglottic_male;

    var w = 430, h = 412, m = 30, max = min = 0;
    /* Computed Data progression, survival, prob, censored */
    for (var a = 0; a < data.treatments.length; a++) {
        for (var b = 0; b < data.treatments[a].length; b++) {
            var reed = data.treatments[a][b];
            var brad = (b > 0) ? data.treatments[a][b - 1].n - reed.d : reed.n;

            reed.progression = reed.d / reed.n;
            reed.survival = 1 - reed.progression;
            reed.prob = (b == 0) ? reed.survival : data.treatments[a][b - 1].prob * reed.survival;
            max = (max < reed.t) ? reed.t : max;
            reed.censored = (reed.n < brad) ? true : false;
        }
    }


    /* Begin d3.js */
    //Scalar functions

    var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset(function () {
                return [(this.getBBox().height / 2) + 100, ((this.getBBox().height / 2) - 50)];
            })
            .html(function (d) {
                var coordinates = d3.mouse(this);
                xValue = x.invert(coordinates[0]) - (1.5 * m);
                yValue = y.invert(coordinates[1] - 45);

                var tempName = d3.select(this).attr('id');
                tempName = tempName.toLowerCase();
                d3.select(this).style("stroke-width", "5px");
                d3.select("#chart3").select("svg").selectAll(".circle" + tempName).attr("r", function (d) {
                    return 8;
                });
                return "<strong> Months Survived : " + d3.format(".2f")(xValue) +
                        " months <br/> Risk : " + d3.format(".2f")(100 * (yValue > 1.0 ? 1.0 : yValue)) + " % </strong>";
            });

    var x = d3.scale.linear().domain([0, max]).range([0, w - m - 60]);
    var y = d3.scale.linear().domain([1, 0]).range([10, h - 75]);
    //Define axses
    var xAxis = d3.svg.axis()
            .scale(x)
            .tickSize(2)
            .tickPadding(6)
            .orient("bottom");

    var yAxis = d3.svg.axis()
            .scale(y)
            .tickSize(2)
            .tickPadding(6)
            .orient("left");
    //This is the accessor function
    var lineFunction = d3.svg.line()
            .x(function (d) {
                return x(d.t) + (2.25 * m);
            })
            .y(function (d) {
                return (y(d.prob) + 40);
            })
            .interpolate("step-before");


    //Draw the svg container
    var kaplan = d3.select("#chart2").append("svg")
            .attr("width", w + (2 * m))
            .attr("height", h + (2 * m));

    kaplan.call(tip);
    //Draw the lines
    var african = kaplan.append("path")
            .attr("d", lineFunction(data.treatments[0]))
            .attr("stroke", "#4682B4")
            .attr("stroke-width", 3)
            .attr("fill", "none")
            .attr('id', 'african')
            .attr("opacity", 0.7)
            .on('mouseover', tip.show)
            .on('mouseout', function (d) {
                tip.hide();
                d3.select(this).style("stroke-width", "3px");
                d3.select("#chart3").select("svg").selectAll(".circleafrican").attr("r", function (d) {
                    return 5;
                });
            });

    if (data.treatments[0][0].n != 0) {
        var africanLabel = kaplan.append("text")
                .attr("transform", "translate(" + (x(data.treatments[0][data.treatments[0].length - 1].t) + 70) + "," + (y(data.treatments[0][data.treatments[0].length - 1].prob) + 40) + ")")
                .attr("dy", ".35em")
                .attr("text-anchor", "start")
                .style("fill", "#4682B4")
                .text("African-American");
    }

    var asian = kaplan.append("path")
            .attr("d", lineFunction(data.treatments[1]))
            .attr("stroke", "#ff4c4c")
            .attr("stroke-width", 3)
            .attr("fill", "none")
            .attr('id', 'asian')
            .attr("opacity", 0.7).on('mouseover', tip.show)
            .on('mouseout', function (d) {
                tip.hide();
                d3.select(this).style("stroke-width", "3px");
                d3.select("#chart3").select("svg").selectAll(".circleasian").attr("r", function (d) {
                    return 5;
                });
            });

    if (data.treatments[1][0].n != 0) {
        var asianLabel = kaplan.append("text")
                .attr("transform", "translate(" + (x(data.treatments[1][data.treatments[1].length - 1].t) + 75) + "," + (y(data.treatments[1][data.treatments[1].length - 1].prob) + 30) + ")")
                .attr("dy", ".35em")
                .attr("text-anchor", "start")
                .style("fill", "#ff4c4c")
                .text("Asian");
    }

    var hispanic = kaplan.append("path")
            .attr("d", lineFunction(data.treatments[2]))
            .attr("stroke", "#737373")
            .attr("stroke-width", 3)
            .attr("fill", "none")
            .attr('id', 'hispanic')
            .attr("opacity", 0.7).on('mouseover', tip.show)
            .on('mouseout', function (d) {
                tip.hide();
                d3.select(this).style("stroke-width", "3px");
                d3.select("#chart3").select("svg").selectAll(".circlehispanic").attr("r", function (d) {
                    return 5;
                });
            });

    if (data.treatments[2][0].n != 0) {
        var hispanicLabel = kaplan.append("text")
                .attr("transform", "translate(" + (x(data.treatments[2][data.treatments[2].length - 1].t) + 40) + "," + (y(data.treatments[2][data.treatments[2].length - 1].prob) + 20) + ")")
                .attr("dy", ".35em")
                .attr("text-anchor", "start")
                .style("fill", "#737373")
                .text("Hispanic");
    }

    var other = kaplan.append("path")
            .attr("d", lineFunction(data.treatments[3]))
            .attr("stroke", "#4ca64c")
            .attr("stroke-width", 3)
            .attr("fill", "none")
            .attr('id', 'other')
            .attr("opacity", 0.7).on('mouseover', tip.show)
            .on('mouseout', function (d) {
                tip.hide();
                d3.select(this).style("stroke-width", "3px");
                d3.select("#chart3").select("svg").selectAll(".circleother").attr("r", function (d) {
                    return 5;
                });
            });

    if (data.treatments[3][0].n != 0) {
        var otherLabel = kaplan.append("text")
                .attr("transform", "translate(" + (x(data.treatments[3][data.treatments[3].length - 1].t) - 95) + "," + (y(data.treatments[3][data.treatments[3].length - 1].prob) + 35) + ")")
                .attr("dy", ".35em")
                .attr("text-anchor", "start")
                .style("fill", "#4ca64c")
                .text("Other");
    }

    var white = kaplan.append("path")
            .attr("d", lineFunction(data.treatments[4]))
            .attr("stroke", "#ffae19")
            .attr("stroke-width", 3)
            .attr("fill", "none")
            .attr('id', 'white')
            .attr("opacity", 0.7).on('mouseover', tip.show)
            .on('mouseout', function (d) {
                tip.hide();
                d3.select(this).style("stroke-width", "3px");
                d3.select("#chart3").select("svg").selectAll(".circlewhite").attr("r", function (d) {
                    return 5;
                });
            });

    if (data.treatments[4][0].n != 0) {
        var whiteLabel = kaplan.append("text")
                .attr("transform", "translate(" + (x(data.treatments[4][data.treatments[4].length - 1].t) + 30) + "," + (y(data.treatments[4][data.treatments[4].length - 1].prob) + 30) + ")")
                .attr("dy", ".35em")
                .attr("text-anchor", "start")
                .style("fill", "#ffae19")
                .text("White");
    }

    //Draw the x-axis
    var theXAxis = kaplan.append("g")
            .attr("class", "xaxis")
            .attr("transform", "translate(" + 2 * m + "," + (h - 25) + ")")
            .call(xAxis)

    //Draw the y-axis
    var theYAxis = kaplan.append("g")
            .attr("class", "yaxis")
            .attr("transform", "translate(" + 2 * m + ", " + 1.5 * m + ")")
            .call(yAxis)

    kaplan.append("text")
            .attr("x", (w / 2))
            .attr("y", (h + 15))
            .style("text-anchor", "middle")
            .text("Overall Survival Rate in months");

    kaplan.append("text")
            .attr("transform", "rotate(-90)")
            .attr("x", h - (1.5 * h))
            .attr("y", ((h / 10) - (h / 20) - 10))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .text("Probability of Survival");

    var color_set = d3.scale.ordinal()
            .domain(['concurrent therapy', ' No Chemotherapy'])
            .range(['#ff4c4c', '#197319']);
}


function treemap2() {


    window.addEventListener('message', function (e) {
        var opts = e.data.opts,
                data = e.data.data;

        return main(opts, data);
    });

    var defaults = {
        margin: {top: 24, right: 0, bottom: 0, left: 0},
        rootname: "TOP",
        format: ",d",
        title: "",
        width: 400,
        height: 400
    };

    function main(o, data) {
        var root,
                opts = $.extend(true, {}, defaults, o),
                formatNumber = d3.format(opts.format),
                rname = opts.rootname,
                margin = opts.margin,
                theight = 36 + 16;

        $('#chart1Sub').width(opts.width).height(opts.height);
        var width = opts.width - margin.left - margin.right,
                height = opts.height - margin.top - margin.bottom - theight,
                transitioning;

        var color = d3.scale.category20c();

        var x = d3.scale.linear()
                .domain([0, width])
                .range([0, width]);

        var y = d3.scale.linear()
                .domain([0, height])
                .range([0, height]);

        var treemap = d3.layout.treemap()
                .children(function (d, depth) {
                    return depth ? null : d._children;
                })
                .sort(function (a, b) {
                    return a.value - b.value;
                })
                .ratio(height / width * 0.5 * (1 + Math.sqrt(5)))
                .round(false);

        var svg = d3.select("#chart1Sub").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.bottom + margin.top)
                .style("margin-left", -margin.left + "px")
                .style("margin.right", -margin.right + "px")
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                .style("shape-rendering", "crispEdges");

        var grandparent = svg.append("g")
                .attr("class", "grandparent");

        grandparent.append("rect")
                .attr("y", -margin.top)
                .attr("width", width)
                .attr("height", margin.top);

        grandparent.append("text")
                .attr("x", 6)
                .attr("y", 6 - margin.top)
                .attr("dy", ".75em");

        if (opts.title) {
            $("#chart1Sub").prepend("<p class='title'>" + opts.title + "</p>");
        }
        if (data instanceof Array) {
            root = {key: rname, values: data};
        } else {
            root = data;
        }

        initialize(root);
        accumulate(root);
        layout(root);
        console.log(root);
        display(root);

        if (window.parent !== window) {
            var myheight = document.documentElement.scrollHeight || document.body.scrollHeight;
            window.parent.postMessage({height: myheight}, '*');
        }

        function initialize(root) {
            root.x = root.y = 0;
            root.dx = width;
            root.dy = height;
            root.depth = 0;
        }

        // Aggregate the values for internal nodes. This is normally done by the
        // treemap layout, but not here because of our custom implementation.
        // We also take a snapshot of the original children (_children) to avoid
        // the children being overwritten when when layout is computed.
        function accumulate(d) {
            return (d._children = d.values)
                    ? d.value = d.values.reduce(function (p, v) {
                        return p + accumulate(v);
                    }, 0)
                    : d.value;
        }

        // Compute the treemap layout recursively such that each group of siblings
        // uses the same size (1�1) rather than the dimensions of the parent cell.
        // This optimizes the layout for the current zoom state. Note that a wrapper
        // object is created for the parent node for each group of siblings so that
        // the parent�s dimensions are not discarded as we recurse. Since each group
        // of sibling was laid out in 1�1, we must rescale to fit using absolute
        // coordinates. This lets us use a viewport to zoom.
        function layout(d) {
            if (d._children) {
                treemap.nodes({_children: d._children});
                d._children.forEach(function (c) {
                    c.x = d.x + c.x * d.dx;
                    c.y = d.y + c.y * d.dy;
                    c.dx *= d.dx;
                    c.dy *= d.dy;
                    c.parent = d;
                    layout(c);
                });
            }
        }

        function display(d) {
            grandparent
                    .datum(d.parent)
                    .on("click", transition)
                    .select("text")
                    .text(name(d));

            var g1 = svg.insert("g", ".grandparent")
                    .datum(d)
                    .attr("class", "depth");

            var g = g1.selectAll("g")
                    .data(d._children)
                    .enter().append("g");

            g.filter(function (d) {
                return d._children;
            })
                    .classed("children", true)
                    .on("click", transition);

            var children = g.selectAll(".child")
                    .data(function (d) {
                        return d._children || [d];
                    })
                    .enter().append("g");

            children.append("rect")
                    .attr("class", "child")
                    .call(rect)
                    .append("title")
                    .text(function (d) {
                        return d.key + " (" + formatNumber(d.value) + ")";
                    });
            children.append("text")
                    .attr("class", "ctext")
                    .text(function (d) {
                        return d.key;
                    })
                    .call(text2);

            g.append("rect")
                    .attr("class", "parent")
                    .call(rect);

            var t = g.append("text")
                    .attr("class", "ptext")
                    .attr("dy", ".75em")

            t.append("tspan")
                    .text(function (d) {
                        return d.key;
                    });
            t.append("tspan")
                    .attr("dy", "1.0em")
                    .text(function (d) {
                        return formatNumber(d.value);
                    });
            t.call(text);

            g.selectAll("rect")
                    .style("fill", function (d) {
                        return color(d.key);
                    });

            function transition(d) {
                if (transitioning || !d)
                    return;
                transitioning = true;

                var g2 = display(d),
                        t1 = g1.transition().duration(750),
                        t2 = g2.transition().duration(750);

                // Update the domain only after entering new elements.
                x.domain([d.x, d.x + d.dx]);
                y.domain([d.y, d.y + d.dy]);

                // Enable anti-aliasing during the transition.
                svg.style("shape-rendering", null);

                // Draw child nodes on top of parent nodes.
                svg.selectAll(".depth").sort(function (a, b) {
                    return a.depth - b.depth;
                });

                // Fade-in entering text.
                g2.selectAll("text").style("fill-opacity", 0);

                // Transition to the new view.
                t1.selectAll(".ptext").call(text).style("fill-opacity", 0);
                t1.selectAll(".ctext").call(text2).style("fill-opacity", 0);
                t2.selectAll(".ptext").call(text).style("fill-opacity", 1);
                t2.selectAll(".ctext").call(text2).style("fill-opacity", 1);
                t1.selectAll("rect").call(rect);
                t2.selectAll("rect").call(rect);

                // Remove the old node when the transition is finished.
                t1.remove().each("end", function () {
                    svg.style("shape-rendering", "crispEdges");
                    transitioning = false;
                });
            }

            return g;
        }

        function text(text) {
            text.selectAll("tspan")
                    .attr("x", function (d) {
                        return x(d.x) + 6;
                    })
            text.attr("x", function (d) {
                return x(d.x) + 6;
            })
                    .attr("y", function (d) {
                        return y(d.y) + 6;
                    })
                    .style("opacity", function (d) {
                        return this.getComputedTextLength() < x(d.x + d.dx) - x(d.x) ? 1 : 0;
                    });
        }

        function text2(text) {
            text.attr("x", function (d) {
                return x(d.x + d.dx) - this.getComputedTextLength() - 6;
            })
                    .attr("y", function (d) {
                        return y(d.y + d.dy) - 6;
                    })
                    .style("opacity", function (d) {
                        return this.getComputedTextLength() < x(d.x + d.dx) - x(d.x) ? 1 : 0;
                    });
        }

        function rect(rect) {
            rect.attr("x", function (d) {
                return x(d.x);
            })
                    .attr("y", function (d) {
                        return y(d.y);
                    })
                    .attr("width", function (d) {
                        return x(d.x + d.dx) - x(d.x);
                    })
                    .attr("height", function (d) {
                        return y(d.y + d.dy) - y(d.y);
                    });
        }

        function name(d) {
            return d.parent
                    ? name(d.parent) + " / " + d.key + " (" + formatNumber(d.value) + ")"
                    : d.key + " (" + formatNumber(d.value) + ")";
        }
    }

    if (window.location.hash === "") {
        d3.json("therapy.json", function (err, res) {
            if (!err) {
                console.log(res);

                res = res.filter(function (row) {
                    if (row['key'] == site)
                        return row;
                });
                var data = d3.nest().key(function (d) {
                    return d.region;
                }).key(function (d) {
                    return d.subregion;
                }).entries(res);
                main({title: "Overall classification of " + gender + " population diagnosed with " + tstage + " stage of cancer at " + site + " Site"}, {key: "Overall patient", values: data});
            }
        });
    }
}
